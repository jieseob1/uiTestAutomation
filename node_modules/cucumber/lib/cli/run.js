"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = run;

var _ = _interopRequireDefault(require("./"));
var _upgrade_banner = _interopRequireDefault(require("./upgrade_banner"));
var _verror = _interopRequireDefault(require("verror"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function exitWithError(error) {
  console.error(_verror.default.fullStack(error)); // eslint-disable-line no-console
  process.exit(1);
}

async function run() {
  console.log("Running cucumber tests..."); // 디버깅 출력 추가
  const cwd = process.cwd();
  console.log("Current working directory:", cwd); // 디버깅 출력 추가
  const cli = new _.default({
    argv: process.argv,
    cwd: cwd,
    stdout: process.stdout
  });

  let result;

  try {
    result = await cli.run();
    console.log("Cucumber CLI run result:", result); // 디버깅 출력 추가
  } catch (error) {
    console.error("Error caught in try block:", error); // 디버깅 출력 추가
    exitWithError(error);
  }

  if (result.success) {
    console.error(_upgrade_banner.default);
  }

  const exitCode = result.success ? 0 : 1;

  if (result.shouldExitImmediately) {
    process.exit(exitCode);
  } else {
    process.exitCode = exitCode;
  }
}

run().catch(error => {
  console.error("Unhandled error in run function:", error); // 디버깅 출력 추가
  exitWithError(error);
});
